<!DOCTYPE html>
<html>
  <head>
    <title>Report: PrintNightmare</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>
<link rel="stylesheet" href="/css/plyr.css"/>
<link rel="stylesheet" href="/css/flag-icon.min.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />




  

  
  
  
    
  
  

  <link rel="icon" type="image/png" href="/images/site/favicon_hua58ee53404f13ed056fec8f7d3dda299_7304_42x0_resize_box_2.png" />

<meta property="og:title" content="Report: PrintNightmare" />
<meta property="og:description" content="Executive Summary On June 8, 2021, Microsoft released an advisory and patch for a critical vulnerability in the Windows Print Spooler. It was originally classified as a privilege escalation vulnerability. On June 27, 2021, researchers from QiAnXin claimed systems were still vulnerable after the patch and that the exploit could be used to gain remote code execution. A few days later researchers from Sangor released a proof-of-concept exploit on GitHub that validated the claim." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.brenteskridge.com/posts/cti/cve-2021-1675/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-05T06:00:00+06:00" />
<meta property="article:modified_time" content="2021-07-05T06:00:00+06:00" />



    
    
<meta name="description" content="Report: PrintNightmare" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">

<link rel="stylesheet" href="/css/style.css"/>



    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  








  


  




  
  
    
  
  



  
  
    
  
  







  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      
        <img src="/images/site/main-logo_hua58ee53404f13ed056fec8f7d3dda299_7304_42x0_resize_box_2.png" alt="Logo">
      Brent Eskridge</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://www.brenteskridge.com#home">Home</a>
        </li>
        
          
          
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="https://www.brenteskridge.com#about">About</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="https://www.brenteskridge.com#experiences">Experiences</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="https://www.brenteskridge.com#projects">Projects</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="https://www.brenteskridge.com#education">Education</a>
                </li>
              
            
            
              
              
                <li class="nav-item">
                  <a class="nav-link" href="https://www.brenteskridge.com#accomplishments">Certifications and Training</a>
                </li>
              
            
            
              
              
            
            
              
              
            
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                
                  
                    
                    
                  
                  
                    
                    
                  
                  
                    
                    
                  
                  
                    
                    
                  
                  
                    
                    
                  
                  
                    
                    
                      <a class="dropdown-item" href="https://www.brenteskridge.com#volunteering">Volunteer Experience</a>
                    
                  
                  
                    
                    
                      <a class="dropdown-item" href="https://www.brenteskridge.com#publications">Publications</a>
                    
                  
              </div>
            </li>
          
        
        
          <div class="dropdown-divider" id="top-navbar-divider"></div>
        
        
          <li class="nav-item">
            <a class="nav-link" id="blog-link" href="/posts">Posts</a>
          </li>
        
        
        
        
      </ul>
    </div>
  </div>
  
  
    <img src="/images/site/main-logo_hua58ee53404f13ed056fec8f7d3dda299_7304_42x0_resize_box_2.png" class="d-none" id="main-logo" alt="Logo">
  
  
    <img src="/images/site/inverted-logo_hu1f2d7db2c2b87e8575343fca074cd4a9_7289_42x0_resize_box_2.png" class="d-none" id="inverted-logo" alt="Inverted Logo">
  
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <form class="mx-auto" method="get" action="/search">
          <input type="text" name="keyword" value="" placeholder="Search" data-search="" id="search-box" />
        </form>
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/cti/">CTI</a>
      
      <ul class="active">
        
  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/cti/cve-2021-1675/" title="CVE-2021-1675">CVE-2021-1675</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/learning/">Learning</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/learning/getting-more/" title="Get More Out of Reading">Get More Out of Reading</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://www.brenteskridge.com/posts/cti/cve-2021-1675/images/glasses-and-computer.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/brenteskridge_hu658f20e83c8f7238de2711d17ffa7947_20623_120x120_fit_q75_box.jpg' alt="Author Image">
          <h5 class="author-name">Brent Eskridge</h5>
          <p>July 5, 2021</p>
        </div>

        <div class="title">
          <h1>Report: PrintNightmare</h1>
        </div>

        <div class="post-content" id="post-content">
          <h2 id="executive-summary">Executive Summary</h2>
<p>On June 8, 2021, Microsoft released an advisory and patch for a critical vulnerability in the Windows Print Spooler.  It was originally classified as a privilege escalation vulnerability.  On June 27, 2021, researchers from QiAnXin claimed systems were still vulnerable after the patch and that the exploit could be used to gain remote code execution.  A few days later researchers from Sangor released a proof-of-concept exploit on GitHub that validated the claim.  The code was subsequently removed from GitHub, but the code was copied and is now in the wild.  As the only patch for the vulnerability still leaves the system vulnerable to the exploit, the most effective mitigation strategy is to disable the Print Spooler service until an effective patch is released.</p>
<h2 id="technical-summary">Technical Summary</h2>
<p>The source of the vulnerability is the <code>RpcAddPrinterDriver</code> remote procedure call (<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/f23a7519-1c77-4069-9ace-a6d8eae47c22">link</a>).  The function installs a specified printer driver on the server via SMB.  The service then installs and executes the driver using SYSTEM privileges.  The service is enabled by default on Windows Server and Windows operating systems.  This means that unless explicitly configured otherwise, all domain controllers are vulnerable to this exploit.</p>
<p>Note that the exploit can only be executed by an authenticated user to the spooler service.</p>
<p>A version of the PoC exploit can be downloaded from: <a href="https://github.com/afwu/PrintNightmare">https://github.com/afwu/PrintNightmare</a></p>
<p><em>Note: The authors of this PoC exploit claim they have more unknown vulnerabilities that they will disclose at their talk at BlackHat.</em></p>
<h2 id="details">Details</h2>
<p><strong>CVE:</strong> CVE-2021-1675
<strong>AKA:</strong> PrintNightmare
<strong>TYPE:</strong> Remote Code Execution
<strong>Identified by:</strong> Microsoft
<strong>Severity:</strong> CVSS v3.x: 7.8
<strong>Release date:</strong> June 8, 2021
<strong>Last update:</strong> June 21, 2021</p>
<h3 id="known-affected-software">Known Affected Software</h3>
<ul>
<li>Microsoft Windows Server:
<ul>
<li>2004</li>
<li>2008</li>
<li>2008 R2</li>
<li>2012</li>
<li>2012 R2</li>
<li>2016</li>
<li>2019</li>
<li>20H2</li>
</ul>
</li>
<li>Microsoft Windows
<ul>
<li>7</li>
<li>8.1</li>
<li>RT 8.1</li>
<li>10</li>
</ul>
</li>
</ul>
<h2 id="remediation">Remediation</h2>
<p>Currently, the only known remediation is to disable the Windows Print Spooler service.  This should be done on all endpoints, servers and domain controllers.  However, dedicated print servers will still be vulnerable.</p>
<h3 id="remediation-side-effects">Remediation Side-effects</h3>
<p>Microsoft does not recommend disabling the print spooler service in general since Active Directory is unable to delete printer queues for printers that no longer exist on the network without at least one Domain Controller running the service.</p>
<h2 id="related-vulnerability">Related Vulnerability</h2>
<p>On July 1, 2021, Microsoft released CVE-2021-34527 that describes a remote code execution vulnerability in the Windows Print Spooler service.  While the source is also the <code>RpcAddPrinterDriver</code> RPC, Microsoft claims this is a different vulnerability from CVE-2021-1675.  This CVE has a CVSS 3.0 severity rating of 8.8 (higher than CVE-2021-1675).  Since the vulnerability is in the same function, there is no viable patch for this vulnerability either.</p>
<h2 id="history">History</h2>
<p>The Print Spooler service has a long history of bugs and vulnerabilities.  A bug in the service was exploited in the famous Stuxnet worm.  More recently, two criticals exploits were discovered last year (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1048">CVE-2020-1048</a> and <a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-1337">CVE-2020-1337</a>).</p>
<h2 id="sources">Sources</h2>
<ul>
<li><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675</a></li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-1675">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-1675</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-1675">https://nvd.nist.gov/vuln/detail/CVE-2021-1675</a></li>
<li><a href="https://www.rapid7.com/blog/post/2021/06/30/cve-2021-1675-printnightmare-patch-does-not-remediate-vulnerability/">https://www.rapid7.com/blog/post/2021/06/30/cve-2021-1675-printnightmare-patch-does-not-remediate-vulnerability/</a></li>
<li><a href="https://www.blumira.com/cve-2021-1675/">https://www.blumira.com/cve-2021-1675/</a></li>
<li><a href="https://www.helpnetsecurity.com/2021/06/30/poc-cve-2021-1675/">https://www.helpnetsecurity.com/2021/06/30/poc-cve-2021-1675/</a></li>
<li><a href="https://www.tenable.com/blog/cve-2021-1675-proof-of-concept-leaked-for-critical-windows-print-spooler-vulnerability">https://www.tenable.com/blog/cve-2021-1675-proof-of-concept-leaked-for-critical-windows-print-spooler-vulnerability</a></li>
<li><a href="https://www.kb.cert.org/vuls/id/383432">https://www.kb.cert.org/vuls/id/383432</a></li>
<li><a href="https://github.com/afwu/PrintNightmare">https://github.com/afwu/PrintNightmare</a></li>
</ul>

        </div>

        
        

        
      <hr />
        







  





  
    
    
  
  

  
  


<div class="row next-prev-navigator">
  
  
      
      
      <div class="col-md-12 next-article">
        <a href="/posts/learning/getting-more/" title="Get More Out of Reading" class="btn btn-outline-info">
          <div>Next <i class="fas fa-chevron-circle-right"></i></div>
          <div class="next-prev-text">Get More Out of Reading</div>
        </a>
      </div>
    
</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
  <a id="scroll-to-top" class="btn"><i class="fas fa-chevron-circle-up"></i></a>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#executive-summary">Executive Summary</a></li>
    <li><a href="#technical-summary">Technical Summary</a></li>
    <li><a href="#details">Details</a>
      <ul>
        <li><a href="#known-affected-software">Known Affected Software</a></li>
      </ul>
    </li>
    <li><a href="#remediation">Remediation</a>
      <ul>
        <li><a href="#remediation-side-effects">Remediation Side-effects</a></li>
      </ul>
    </li>
    <li><a href="#related-vulnerability">Related Vulnerability</a></li>
    <li><a href="#history">History</a></li>
    <li><a href="#sources">Sources</a></li>
  </ul>
</nav>
      </div>
    </div>
    
    
  </section>

    </div>

    
    











  
  
    
  

  
  
    
  

  
  
    
    
      
    
  


  
  
  

  
  
  

  
  
  
    
  
  

  
  
  

  <footer class="container-fluid text-center align-content-center footer pb-2">
    <div class="container pt-5">
      <div class="row text-left">
        
        <div class="col-md-6 col-sm-12">
          <h5>Navigation</h5>
          
          <ul>
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#about">About</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#experiences">Experiences</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#projects">Projects</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#education">Education</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#accomplishments">Certifications and Training</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#volunteering">Volunteer Experience</a>
                </li>
              
              
                
                
                  
                
                <li class="nav-item">
                  <a class="smooth-scroll" href="/#publications">Publications</a>
                </li>
              
          </ul>
          
        </div>
        
        
        <div class="col-md-6 col-sm-12">
          <h5>Contact me:</h5>
          <ul>
            
            <li><span>Email: </span> <span>me@brenteskridge.com</span></li>
            
          </ul>
        </div>
        
        
      </div>
    </div>
    
    
  </footer>


    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/plyr.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
